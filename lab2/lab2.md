<div align="center">
University: [ITMO University](https://itmo.ru/ru/)

Faculty: [FTMI](https://ftmi.itmo.ru/)

Course: [Cloud platforms as the basis of technology entrepreneurship](https://itmo-ict-faculty.github.io/cloud-platforms-as-the-basis-of-technology-entrepreneurship/) 

Year: 2024/2025

Group: U4225

Author: Gurev Danil Sergeevich

Lab: Lab2

Date of create: 28.10.2024

Date of finished: 02.11.2024
</div>

## Описание
Это вторая лабораторная работа "Исследование Cloud Run"

## Цель работы
Ознакомиться с работой Cloud Run.

## Ход работы
Cloud Run - это управляемая вычислительная платформа, которая позволяет запускать контейнеры (изолированная среда для приложения) непосредственно поверх масштабируемой инфраструктуры Google.

1. Создал Cloud Run из представленного дефолтного сервиса с минимальным количеством ресурсов.
На фото ниже показано, что ресурсы минимальные.
![image](https://github.com/user-attachments/assets/60eb5466-b977-445b-aff3-a53c8ec5f24c)

Первая версия была создана на порту 8080 - cтандартный порт для веб-сервисов.

Образ контейнера задеплоен:

![image](https://github.com/user-attachments/assets/e54b2b5a-f901-4d56-b3d8-e0c8c1c56817)


2. Проанализировал логи:

![image](https://github.com/user-attachments/assets/5e377a17-53fc-4a44-9883-d16e5c708904)


В логах можно увидеть, что служба Cloud Run с именем "hello-pogodin-ai" была успешно создана в регионе "us-central1" пользователем "zhenolan@gmail.com" с помощью Google Cloud Console. Далее можно по логам можно увидеть, что служба Cloud Run «hello-pogodin-ai» принимает запросы на порту 8080, а также можно увидеть информацию об успешно принятых HTTP GET-запросах.

3. Проанализировал метрики:

Среди метрик представлены следующие: количество запросов, задержка запросов, количество экзмепляров контейнера, оплачиваемое время экземпляра контейнера, загрузка ЦП контейнера, использование памяти котнейнера, количество отправленных и полученных байтов, максимальное количество одновременных запросов и задержка запуска контейнера.

Активность на отображаемых графиках метрик происходила за счет того, что я обращался к странице с информацией о запуске образа контейнера (см.выше).

![image](https://github.com/user-attachments/assets/a137a207-8c23-49be-a069-e8aa1b4b4e04)

![image](https://github.com/user-attachments/assets/23ed89d2-7af3-447f-98d4-c2ab5a87e644)

![image](https://github.com/user-attachments/assets/394fd272-6276-42f8-a1ee-bc7fb59ae46d)

4. Далее создал еще один образ контейнера на порту 8090 - альтернативный порт для веб-сервисов
![image](https://github.com/user-attachments/assets/c14437b9-8d44-4782-b984-d85495632cf2)


6. Проанализировал логи:

![image](https://github.com/user-attachments/assets/d7b4498d-6a79-4172-8426-7808aad0141f)



В логах можно отметить, что произошло успешное обновление сервиса Cloud Run "hello-pogodin-ai" в регионе "us-central1", служба Cloud Run «hello-pogodin-ai» принимает запросы на порту 8090.

7. Проанализировал метрики:
![image](https://github.com/user-attachments/assets/cd833ef5-9b93-415f-a389-db96dd823ee3)

![image](https://github.com/user-attachments/assets/f00aecd9-66d0-4162-9750-9e8946095c0f)

![image](https://github.com/user-attachments/assets/d9a37247-6cd9-43c7-b9d7-269e603057a6)


Анализ метрик, представленных на графиках, помогает понять производительность контейнера и состояние приложения. Вот ключевые моменты:

Request Count: Количество запросов показывает явное снижение в установленные временные моменты. Это может указывать на проблемы с доступностью или изменением в трафике.

Request Latencies: Задержка запросов в основном находится в пределах до 10 мс, но на графике есть пики, которые могут указывать на краткосрочные проблемы с производительностью.

Container Instance Count & Billable Container Instance Time: Общее количество инстансов контейнера варьируется, что может быть результатом автоматического масштабирования. Убедитесь, что у вас достаточно ресурсов для обработки нагрузки пиковой.

CPU Utilization: Загрузка ЦП остается на уровне 1%, что свидетельствует о низкой нагрузке на контейнер. Это может указывать на )хорошо оптимизированные задачи или недостаточную нагрузку.

Memory Utilization: Память используется на уровне 10%, что также говорит о низком уровне использования ресурсов.

Sent and Received Bytes: Отправленные и полученные байты имеют низкие значения, что может указывать на недостаточный объем трафика или возможные проблемы с соединением.

Max Concurrent Requests: В течение времени количество одновременно обрабатываемых запросов колебалось, что может быть связано с улучшением или ухудшением рабочей нагрузки.

Container Startup Latency: Задержка при запуске контейнера может вызывать замедления, если она превышает определенные границы. Следует внимательно отслеживать, чтобы процесс развертывания проходил более гладко.

8. Протестировал переключения трафика между версиями:
    
90%/10%:

![image](https://github.com/user-attachments/assets/10efdb77-5a97-402f-9146-5fc8513654a6)


Лог, показывающий распределение трафика:

![image](https://github.com/user-attachments/assets/a4bf3e8b-9366-4d0d-bec5-35dc40bc694a)


50%/50%:

![image](https://github.com/user-attachments/assets/49e7fd1b-590f-4df0-8a1f-c21080b2e5b8)


Лог, показывающий распределение трафика:

![image](https://github.com/user-attachments/assets/9a7fa823-5639-4433-a752-afd24ae07f1a)


Сравнение метрик показало, что обе версии обрабатывают запросы одинаково, без значительных различий в производительности.

Преимущества и особенности переключения трафика:
Возможность направить только часть трафика на новую версию позволяет снизить риски при развертывании обновлений, особенно если они содержат значительные изменения.
В процессе переключения трафика можно анализировать поведение новых изменений на небольшой группе пользователей, проверяя логи и метрики для обеих версий. Это помогает оперативно выявить и устранить потенциальные ошибки.
Если новая версия показывает сбои, то в любой момент можно быстро перенаправить весь трафик обратно на стабильную версию, избегая долгих простоев.
Cloud Run автоматически масштабирует как старую, так и новую версии по мере роста нагрузки, что позволяет не беспокоиться о производительности при тестировании изменений на части трафика.


9. Удалил за собой все созданные сервисы

## Выводы

- В ходе выполнения работы был успешно развернут сервис на Cloud Run.
- Проведено тестирование работы сервиса, настройка минимального уровня ресурсов.
- Проанализированы логи и метрики, что дало представление о производительности и нагрузке на сервис.
- Проверено поведение сервиса при изменении порта — было установлено, что Cloud Run поддерживает работу с портом 8080 по умолчанию.
- Проведен эксперимент с переключением трафика между версиями, что продемонстрировало гибкость Cloud Run в управлении трафиком и версиями.

Cloud Run предоставляет мощные возможности для развертывания контейнеризированных приложений с минимальными усилиями и высокой гибкостью в управлении версиями и трафиком. Сервис автоматически масштабируется под нагрузку, при этом сохраняется простота настройки и управления.
